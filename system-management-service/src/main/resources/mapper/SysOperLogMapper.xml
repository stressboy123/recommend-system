<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdut.system.management.mapper.SysOperLogMapper">

    <!-- 通用字段片段（对应 SysOperLog 实体） -->
    <sql id="baseColumns">
        id, oper_user_id, oper_module, oper_type, oper_content,
        oper_ip, oper_time, oper_result
    </sql>

    <!-- 插入单条日志 -->
    <insert id="insertSysOperLogSingle" parameterType="com.gdut.system.management.entity.SysOperLog">
        INSERT INTO sys_oper_log (
            id, oper_user_id, oper_module, oper_type, oper_content,
            oper_ip, oper_time, oper_result
        ) VALUES (
                     #{id}, #{operUserId}, #{operModule}, #{operType}, #{operContent},
                     #{operIp}, #{operTime}, #{operResult}
                 )
    </insert>

    <!-- 批量插入日志（日志插入频繁，建议优化SQL执行效率） -->
    <insert id="insertSysOperLogMulti" parameterType="java.util.List">
        INSERT INTO sys_oper_log (
        id, oper_user_id, oper_module, oper_type, oper_content,
        oper_ip, oper_time, oper_result
        ) VALUES
        <foreach collection="list" item="item" separator=",">
            (
            #{item.id}, #{item.operUserId}, #{item.operModule}, #{item.operType}, #{item.operContent},
            #{item.operIp}, #{item.operTime}, #{item.operResult}
            )
        </foreach>
    </insert>

    <!-- 删除单条日志 -->
    <delete id="deleteSysOperLogSingle" parameterType="java.lang.String">
        DELETE FROM sys_oper_log WHERE id = #{logId}
    </delete>

    <!-- 批量删除日志 -->
    <delete id="deleteSysOperLogMulti" parameterType="java.util.List">
        DELETE FROM sys_oper_log WHERE id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 更新单条日志（仅允许修改 oper_result，如需扩展可调整 if 条件） -->
    <update id="updateSysOperLogSingle" parameterType="com.gdut.system.management.entity.SysOperLog">
        UPDATE sys_oper_log
        <set>
            <if test="operResult != null">oper_result = #{operResult}</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 批量更新日志 -->
    <update id="updateSysOperLogMulti" parameterType="java.util.List">
        <foreach collection="list" item="item" separator=";">
            UPDATE sys_oper_log
            <set>
                <if test="item.operResult != null">oper_result = #{item.operResult}</if>
            </set>
            WHERE id = #{item.id}
        </foreach>
    </update>

    <!-- 查询单条日志（修正方法名对应） -->
    <select id="selectSysOperLogSingle" parameterType="java.lang.String" resultType="com.gdut.system.management.entity.SysOperLog">
        SELECT <include refid="baseColumns"/> FROM sys_oper_log WHERE id = #{logId}
    </select>

    <!-- 批量查询日志 -->
    <select id="selectSysOperLogMulti" parameterType="java.util.List" resultType="com.gdut.system.management.entity.SysOperLog">
        SELECT <include refid="baseColumns"/> FROM sys_oper_log WHERE id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

</mapper>